

regfile vec32x4 128 4 vec
state simdAcc 32 add_read_write

operation dotprod {out AR sum, in vec32x4 a, in vec32x4 b}{inout simdAcc}
{
	//4-way SIMD multiplication
	wire [31:0] prod0 = a[31:0]*b[31:0];
	wire [31:0] prod1 = a[63:32]*b[63:32];
	wire [31:0] prod2 = a[95:64]*b[95:64];
	wire [31:0] prod3 = a[127:96]*b[127:96];

	assign simdAcc = simdAcc+prod0+prod1+prod2+prod3;
	assign sum=prod0+prod1+prod2+prod3;
}